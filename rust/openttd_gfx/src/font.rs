//! Simple bitmap font rendering for basic text display

use crate::Colour;

/// Simple 8x8 bitmap font data
/// Each character is represented as 8 bytes, where each byte represents one row
/// and each bit represents a pixel (1 = on, 0 = off)
pub struct BitmapFont;

impl BitmapFont {
    /// Get the bitmap data for a character
    /// Returns 8 bytes representing an 8x8 pixel grid
    pub fn get_char_data(ch: char) -> [u8; 8] {
        match ch {
            // Numbers
            '0' => [
                0b00111100, 0b01100110, 0b01101110, 0b01110110, 0b01100110, 0b01100110, 0b00111100,
                0b00000000,
            ],
            '1' => [
                0b00011000, 0b00111000, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00111100,
                0b00000000,
            ],
            '2' => [
                0b00111100, 0b01100110, 0b00000110, 0b00001100, 0b00011000, 0b00110000, 0b01111110,
                0b00000000,
            ],
            '3' => [
                0b00111100, 0b01100110, 0b00000110, 0b00011100, 0b00000110, 0b01100110, 0b00111100,
                0b00000000,
            ],
            '4' => [
                0b00001100, 0b00011100, 0b00101100, 0b01001100, 0b01111110, 0b00001100, 0b00001100,
                0b00000000,
            ],
            '5' => [
                0b01111110, 0b01100000, 0b01111100, 0b00000110, 0b00000110, 0b01100110, 0b00111100,
                0b00000000,
            ],
            '6' => [
                0b00111100, 0b01100110, 0b01100000, 0b01111100, 0b01100110, 0b01100110, 0b00111100,
                0b00000000,
            ],
            '7' => [
                0b01111110, 0b00000110, 0b00001100, 0b00011000, 0b00110000, 0b00110000, 0b00110000,
                0b00000000,
            ],
            '8' => [
                0b00111100, 0b01100110, 0b01100110, 0b00111100, 0b01100110, 0b01100110, 0b00111100,
                0b00000000,
            ],
            '9' => [
                0b00111100, 0b01100110, 0b01100110, 0b00111110, 0b00000110, 0b01100110, 0b00111100,
                0b00000000,
            ],

            // Letters A-Z
            'A' | 'a' => [
                0b00111100, 0b01100110, 0b01100110, 0b01111110, 0b01100110, 0b01100110, 0b01100110,
                0b00000000,
            ],
            'B' | 'b' => [
                0b01111100, 0b01100110, 0b01100110, 0b01111100, 0b01100110, 0b01100110, 0b01111100,
                0b00000000,
            ],
            'C' | 'c' => [
                0b00111100, 0b01100110, 0b01100000, 0b01100000, 0b01100000, 0b01100110, 0b00111100,
                0b00000000,
            ],
            'D' | 'd' => [
                0b01111100, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01111100,
                0b00000000,
            ],
            'E' | 'e' => [
                0b01111110, 0b01100000, 0b01100000, 0b01111100, 0b01100000, 0b01100000, 0b01111110,
                0b00000000,
            ],
            'F' | 'f' => [
                0b01111110, 0b01100000, 0b01100000, 0b01111100, 0b01100000, 0b01100000, 0b01100000,
                0b00000000,
            ],
            'G' | 'g' => [
                0b00111100, 0b01100110, 0b01100000, 0b01101110, 0b01100110, 0b01100110, 0b00111100,
                0b00000000,
            ],
            'H' | 'h' => [
                0b01100110, 0b01100110, 0b01100110, 0b01111110, 0b01100110, 0b01100110, 0b01100110,
                0b00000000,
            ],
            'I' | 'i' => [
                0b00111100, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00111100,
                0b00000000,
            ],
            'J' | 'j' => [
                0b00011110, 0b00001100, 0b00001100, 0b00001100, 0b01101100, 0b01101100, 0b00111000,
                0b00000000,
            ],
            'K' | 'k' => [
                0b01100110, 0b01101100, 0b01111000, 0b01110000, 0b01111000, 0b01101100, 0b01100110,
                0b00000000,
            ],
            'L' | 'l' => [
                0b01100000, 0b01100000, 0b01100000, 0b01100000, 0b01100000, 0b01100000, 0b01111110,
                0b00000000,
            ],
            'M' | 'm' => [
                0b01100011, 0b01110111, 0b01111111, 0b01101011, 0b01100011, 0b01100011, 0b01100011,
                0b00000000,
            ],
            'N' | 'n' => [
                0b01100110, 0b01110110, 0b01111110, 0b01101110, 0b01100110, 0b01100110, 0b01100110,
                0b00000000,
            ],
            'O' | 'o' => [
                0b00111100, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b00111100,
                0b00000000,
            ],
            'P' | 'p' => [
                0b01111100, 0b01100110, 0b01100110, 0b01111100, 0b01100000, 0b01100000, 0b01100000,
                0b00000000,
            ],
            'Q' | 'q' => [
                0b00111100, 0b01100110, 0b01100110, 0b01100110, 0b01101010, 0b01101100, 0b00110110,
                0b00000000,
            ],
            'R' | 'r' => [
                0b01111100, 0b01100110, 0b01100110, 0b01111100, 0b01101100, 0b01100110, 0b01100110,
                0b00000000,
            ],
            'S' | 's' => [
                0b00111100, 0b01100110, 0b01100000, 0b00111100, 0b00000110, 0b01100110, 0b00111100,
                0b00000000,
            ],
            'T' | 't' => [
                0b01111110, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00011000,
                0b00000000,
            ],
            'U' | 'u' => [
                0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b00111100,
                0b00000000,
            ],
            'V' | 'v' => [
                0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b00111100, 0b00011000, 0b00011000,
                0b00000000,
            ],
            'W' | 'w' => [
                0b01100011, 0b01100011, 0b01100011, 0b01101011, 0b01111111, 0b01110111, 0b01100011,
                0b00000000,
            ],
            'X' | 'x' => [
                0b01100110, 0b01100110, 0b00111100, 0b00011000, 0b00111100, 0b01100110, 0b01100110,
                0b00000000,
            ],
            'Y' | 'y' => [
                0b01100110, 0b01100110, 0b00111100, 0b00011000, 0b00011000, 0b00011000, 0b00011000,
                0b00000000,
            ],
            'Z' | 'z' => [
                0b01111110, 0b00000110, 0b00001100, 0b00011000, 0b00110000, 0b01100000, 0b01111110,
                0b00000000,
            ],

            // Special characters
            ' ' => [0, 0, 0, 0, 0, 0, 0, 0],
            '!' => [
                0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00011000, 0b00000000, 0b00011000,
                0b00000000,
            ],
            '.' => [
                0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00011000, 0b00011000,
                0b00000000,
            ],
            ',' => [
                0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00011000, 0b00011000, 0b00110000,
                0b00000000,
            ],
            ':' => [
                0b00000000, 0b00011000, 0b00011000, 0b00000000, 0b00011000, 0b00011000, 0b00000000,
                0b00000000,
            ],
            '-' => [
                0b00000000, 0b00000000, 0b00000000, 0b01111110, 0b00000000, 0b00000000, 0b00000000,
                0b00000000,
            ],
            '/' => [
                0b00000110, 0b00001100, 0b00011000, 0b00110000, 0b01100000, 0b11000000, 0b10000000,
                0b00000000,
            ],
            '#' => [
                0b01101100, 0b01101100, 0b11111110, 0b01101100, 0b11111110, 0b01101100, 0b01101100,
                0b00000000,
            ],
            '(' => [
                0b00001100, 0b00011000, 0b00110000, 0b00110000, 0b00110000, 0b00011000, 0b00001100,
                0b00000000,
            ],
            ')' => [
                0b00110000, 0b00011000, 0b00001100, 0b00001100, 0b00001100, 0b00011000, 0b00110000,
                0b00000000,
            ],

            // Default for unknown characters
            _ => [
                0b01111110, 0b01000010, 0b01000010, 0b01000010, 0b01000010, 0b01000010, 0b01111110,
                0b00000000,
            ],
        }
    }

    /// Draw a character at the specified position
    pub fn draw_char(
        pixels: &mut [u8],
        pitch: usize,
        x: i32,
        y: i32,
        ch: char,
        color: Colour,
        scale: u32,
    ) {
        let char_data = Self::get_char_data(ch);
        let bytes_per_pixel = 4; // RGBA

        for (row_idx, &row_data) in char_data.iter().enumerate() {
            for col_idx in 0..8 {
                if row_data & (0b10000000 >> col_idx) != 0 {
                    // Draw scaled pixel
                    for sy in 0..scale {
                        for sx in 0..scale {
                            let px = x + (col_idx as i32 * scale as i32) + sx as i32;
                            let py = y + (row_idx as i32 * scale as i32) + sy as i32;

                            if px >= 0 && py >= 0 {
                                let offset =
                                    (py as usize * pitch) + (px as usize * bytes_per_pixel);
                                if offset + 3 < pitch * 600 {
                                    // Assume max height of 600 for safety
                                    if let Some(pixel) = pixels.get_mut(offset..offset + 4) {
                                        pixel[0] = color.b;
                                        pixel[1] = color.g;
                                        pixel[2] = color.r;
                                        pixel[3] = color.a;
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    /// Draw a string at the specified position
    pub fn draw_string(
        pixels: &mut [u8],
        pitch: usize,
        x: i32,
        y: i32,
        text: &str,
        color: Colour,
        scale: u32,
    ) {
        let char_width = 8 * scale as i32;
        let mut current_x = x;

        for ch in text.chars() {
            Self::draw_char(pixels, pitch, current_x, y, ch, color, scale);
            current_x += char_width;
        }
    }
}
